{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
.page-content {
  padding: 40px;
  margin-top: 80px;
  min-height: calc(100vh - 80px);
  background-color: #1f2933;
}

.form-wrapper {
  max-width: 520px;
  margin: 0 auto;
  background: #ffffff;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  color: #111827;
}

.form-wrapper h2 {
  text-align: center;
  margin-bottom: 20px;
  font-weight: 600;
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
}

.form-group select,
.form-group input,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  outline: none;
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
}

.submit-btn {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  color: white;
  border: none;
}

.income-btn { background: #22c55e; }
.outcome-btn { background: #ef4444; }
.inactive { opacity: 0.6; }

.error-message {
  background: #fee2e2;
  color: #dc2626;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 16px;
  text-align: center;
}
</style>

<div class="page-content">
  <div class="form-wrapper">

    <h2>Add Transaction</h2>

    {% if messages %}
      {% for message in messages %}
        <div class="error-message">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- TYPE SWITCH -->
    <div style="display:flex; gap:12px; margin-bottom:20px;">
      <button type="button" id="incomeBtn" class="submit-btn income-btn inactive">
        ➕ INCOME
      </button>
      <button type="button" id="expenseBtn" class="submit-btn outcome-btn">
        ➖ EXPENSE
      </button>
    </div>

    <form method="POST">
      {% csrf_token %}

      <input type="hidden" name="type" id="typeInput" value="expense">

      <!-- WALLET -->
      <div class="form-group">
        <label>Wallet</label>
        <select name="wallet" required>
          <option value="">Select wallet</option>
          {% for w in wallet %}
            <option value="{{ w.id }}">
              {{ w.title }} — {{ w.balance|floatformat:0 }} UZS
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- CATEGORY -->
      <div class="form-group">
        <label style="display:flex; justify-content:space-between; align-items:center;">
          <span>Category</span>
          <a href="{% url 'main:add_category' %}"
             style="font-size:13px; color:#2563eb; font-weight:600; text-decoration:none;">
            ➕ Add
          </a>
        </label>
        <select name="category" id="categorySelect" required>
          <option value="">Select category</option>
          {% for c in categories %}
            <option value="{{ c.id }}" data-type="{{ c.type_p }}">
              {{ c.title }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- AMOUNT -->
      <div class="form-group">
        <label>Amount</label>
        <input type="number" step="0.01" name="amount" required>
      </div>

      <!-- COMMENT -->
      <div class="form-group">
        <label>Comment (optional)</label>
        <textarea name="comment"></textarea>
      </div>

      <button type="submit" id="submitBtn" class="submit-btn outcome-btn">
        Save Transaction
      </button>
    </form>

  </div>
</div>

<script>
const typeInput = document.getElementById("typeInput");
const categorySelect = document.getElementById("categorySelect");
const incomeBtn = document.getElementById("incomeBtn");
const expenseBtn = document.getElementById("expenseBtn");
const submitBtn = document.getElementById("submitBtn");

function setType(type) {
  typeInput.value = type;
  categorySelect.value = "";

  [...categorySelect.options].forEach(option => {
    if (!option.dataset.type) return;
    const match = option.dataset.type === type;
    option.hidden = !match;
    option.disabled = !match;
  });

  if (type === "income") {
    incomeBtn.classList.remove("inactive");
    expenseBtn.classList.add("inactive");
    submitBtn.className = "submit-btn income-btn";
  } else {
    expenseBtn.classList.remove("inactive");
    incomeBtn.classList.add("inactive");
    submitBtn.className = "submit-btn outcome-btn";
  }
}

incomeBtn.onclick = () => setType("income");
expenseBtn.onclick = () => setType("expense");

document.addEventListener("DOMContentLoaded", () => {
  setType("expense");
});
</script>

{% endblock %}
